Voici les mÃ©thodes 3 et 4 dÃ©taillÃ©es au niveau N4/N5, telles quâ€™utilisÃ©es dans des environnements oÃ¹ le fournisseur cloud ne permet pas le boot sur ISO (IBM Cloud VSI, OpenStack restreint, VMware sans virtual media).
Ces mÃ©thodes transforment GRUB + initramfs en un vÃ©ritable environnement rescue local, sans ISO, sans seconde VM, directement sur le disque.

Ce sont des techniques avancÃ©es, rarement documentÃ©es, et utilisÃ©es par des experts SRE / kernels / rescue-level.


---

ğŸŸ¥ MÃ‰THODE 3 â€” Boot Rescue via chainloading dâ€™un rootfs minimal local

(Hack GRUB + rootfs interne)


---

ğŸ¯ Objectif

CrÃ©er un root filesystem minimal (basÃ© sur BusyBox ou Alpine) dans un fichier,
le placer dans /boot,
et configurer GRUB pour booter directement dessus â†’ Ã©quivalent Ã  un Rescue Boot.

Aucune ISO, aucun loop externe.
Fonctionne mÃªme si ton rootfs principal est cassÃ©.


---

ğŸ”§ Ã‰TAPE 1 â€” CrÃ©ation dâ€™un rootfs minimal BusyBox

CrÃ©er un dossier qui va recevoir le systÃ¨me de fichiers :

mkdir /root/rescue_rootfs
cd /root/rescue_rootfs

Installer BusyBox statique (selon OS) :

dnf install busybox -y

CrÃ©er lâ€™arborescence minimale :

mkdir -p bin dev proc sys etc
cp /bin/busybox bin/

CrÃ©er un shell par dÃ©faut :

ln -s /bin/busybox bin/sh


---

ğŸ”§ Ã‰TAPE 2 â€” CrÃ©ation dâ€™un init script interne

CrÃ©er /root/rescue_rootfs/init :

cat << 'EOF' > init
#!/bin/sh
mount -t proc none /proc
mount -t sysfs none /sys
mount -t devtmpfs none /dev

echo "==== RESCUE MODE ===="
echo "Montage du disque racine pour reparation..."

# Exemple : activer LVM si nÃ©cessaire
vgchange -ay

# Laisser une shell ouverte
exec /bin/sh
EOF
chmod +x init

Câ€™est un init minimal comme dans un initramfs.


---

ğŸ”§ Ã‰TAPE 3 â€” CrÃ©er un initramfs Ã  partir de ce rootfs

cd /root/rescue_rootfs
find . | cpio -o -H newc | gzip > /boot/rootfs-rescue.img

Tu as maintenant :

/boot/rootfs-rescue.img


---

ğŸ”§ Ã‰TAPE 4 â€” Ajouter un menu GRUB â€œRescue Modeâ€

Ã‰diter /etc/grub.d/40_custom :

menuentry "Rescue Local RootFS" {
    insmod gzio
    insmod part_gpt
    insmod ext2

    linux /boot/vmlinuz-<VERSION> rescue=1 rd.break
    initrd /boot/rootfs-rescue.img
}

Remplacer <VERSION> par :

uname -r

RegÃ©nÃ©rer GRUB :

grub2-mkconfig -o /boot/grub2/grub.cfg


---

ğŸš€ RÃ‰SULTAT MÃ‰THODE 3

Au prochain reboot, tu sÃ©lectionnes :

Rescue Local RootFS

Tu arrives dans un shell BusyBox minimal, totalement indÃ©pendant du systÃ¨me cassÃ©.

Tu peux alors :

monter /dev/vda ou LVM

chrooter dans le systÃ¨me cassÃ©

rÃ©parer GRUB

rÃ©parer dracut

reconstruire initramfs

rÃ©cupÃ©rer les logs

manipuler un FS cassÃ©

xfs_repair ou fsck vers root



---

ğŸŸ¦ MÃ‰THODE 4 â€” Boot Rescue via initramfs personnalisÃ© (super puissant)

(Utiliser dracut pour fabriquer un initramfs contenant un OS rescue complet)


---

ğŸ¯ Objectif

Construire un initramfs personnalisÃ© qui contient :

BusyBox

les outils de rÃ©paration (xfs_repair, fsck, lvm, cryptsetupâ€¦)

un shell interactif

un mode â€œrescueâ€ avant montage root


Tu remplaces uniquement lâ€™initramfs dans GRUB, sans toucher le systÃ¨me.

Câ€™est encore plus robuste que la mÃ©thode 3, car tu nâ€™as pas besoin de crÃ©er un rootfs complet.


---

ğŸ”§ Ã‰TAPE 1 â€” Installer busybox pour lâ€™initramfs

dnf install busybox dracut-network -y


---

ğŸ”§ Ã‰TAPE 2 â€” GÃ©nÃ©rer un initramfs rescue

Avec dracut :

dracut --force \
       --add-rescue \
       --add "busybox" \
       --omit plymouth \
       /boot/initramfs-rescue.img \
       $(uname -r)

Explications :

Option	RÃ´le

--add-rescue	Ajoute le module rescue intÃ©grÃ© de dracut
--add busybox	Ajoute toutes les commandes busybox dans initramfs
--omit plymouth	Retire les animations et accÃ©lÃ¨re le boot
Chemin initramfs	On crÃ©e un initramfs parallÃ¨le uniquement pour rescue



---

ğŸ”§ Ã‰TAPE 3 â€” Ajouter entrÃ©e GRUB pour initramfs Rescue

Dans /etc/grub.d/40_custom :

menuentry "DRACUT RESCUE MODE" {
    linux /boot/vmlinuz-$(uname -r) rd.break rd.shell
    initrd /boot/initramfs-rescue.img
}

RegÃ©nÃ©rer :

grub2-mkconfig -o /boot/grub2/grub.cfg


---

ğŸš€ RÃ‰SULTAT MÃ‰THODE 4

Au boot, sÃ©lectionner :

DRACUT RESCUE MODE

Tu tombes dans :

dracut:/#

Avec :

tous les modules LVM

tous les drivers nÃ©cessaires

BusyBox (sh, awk, sed, mountâ€¦)

outils rÃ©seau (si dracut-network prÃ©sent)

outils de rÃ©paration FS


FonctionnalitÃ©s disponibles :

âœ” Activer LVM :

lvm vgchange -ay

âœ” Monter root :

mount /dev/mapper/rootvg-rootlv /mnt

âœ” Reparer initramfs cassÃ© :

chroot /mnt
dracut --force

âœ” RÃ©installer GRUB :

grub2-install /dev/vda
grub2-mkconfig -o /boot/grub2/grub.cfg

âœ” Diagnostiquer un kernel panic

Tu as accÃ¨s :

au journal du boot

au kernel command line

aux modules du kernel

au chargement des drivers


ğŸ”‹ AVANTAGE

â¡ï¸ Tu nâ€™as besoin que de GRUB fonctionnel.
â¡ï¸ Câ€™est le vrai â€œrescue bootâ€ local idÃ©al pour IBM Cloud VSI.


---

ğŸ“Œ MÃ‰THODE 3 vs MÃ‰THODE 4

CritÃ¨re	MÃ©thode 3 (rootfs local)	MÃ©thode 4 (initramfs rescue)

DifficultÃ©	â­â­â­â­	â­â­â­
DÃ©pendance GRUB	Oui	Oui
Taille	10â€“40 MB	8â€“15 MB
Shell	BusyBox	BusyBox + Dracut
CapacitÃ©s FS	TrÃ¨s bon	Excellent
CapacitÃ©s LVM	Avec modules	IntÃ©grÃ©es
Boot rapide	Moyen	TrÃ¨s rapide
CompatibilitÃ© IBM VSI	100%	100%


â¡ï¸ MÃ©thode 4 est la plus propre et la plus puissante.
â¡ï¸ MÃ©thode 3 est la plus flexible (OS minimal complet).


---

ğŸ¯ RÃ©sumÃ© ultra-court

MÃ‰THODE 3 â†’ CrÃ©er un rootfs minimal + GRUB entry

â¡ï¸ RÃ©sultat : un mini-OS rescue bootable Ã  partir de /boot.

MÃ‰THODE 4 â†’ CrÃ©er un initramfs rescue complet

â¡ï¸ RÃ©sultat : un dracut shell avancÃ©, parfait pour rÃ©parer kernel panic / initramfs / grub.


---

ğŸ§© Tu veux maintenant :

âœ” Une procedure pour IBM Cloud VSI complÃ¨te avec schÃ©mas ?
âœ” Un script automation pour crÃ©er le initramfs-rescue en 1 commande ?
âœ” Une procÃ©dure N4 pour rÃ©parer kernel panic / dracut prompt via mÃ©thode 4 ?